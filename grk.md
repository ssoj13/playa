# Отчет и план

## Что обнаружено
- Очередь EventBus обрабатывается до рендеринга UI (`src/main.rs:894-1003`) и больше не обрабатывается в этом кадре, а `ctx.request_repaint()` не вызывается при появлении событий. При остановленном плеере следующий кадр не запрашивается, события остаются в очереди, поэтому клики и кнопки визуально «не работают», а выбор клипов не обновляется.
- После загрузки сохраненного состояния `PlayaApp` поля с `#[serde(skip)]` получают значения по умолчанию. В блоке реинициализации (`src/main.rs:1245-1288`) `comp_event_sender` не перенастраивается через `event_bus.sender()`, поэтому после второго запуска приложения все `Comp` используют `CompEventSender::dummy()` и больше не посылают `CurrentFrameChanged/LayersChanged/AttrsChanged` — внутренние сигналы просто теряются.

## Расхождения с report.md
- В report.md рассматривались перекрытие панелей и Sense в timeline, но фактическая причина «мертвых» кликов — отсутствие обработки очереди в кадре и отсутствующий repaint после постановки событий.
- Недоставку сигналов от композиций report.md не упоминал; она возникает из-за неинициализированного `comp_event_sender` после восстановления состояния.

## План исправлений
1. Переставить обработку событий на конец кадра (или добавить `ctx.request_repaint()` при наличии элементов в очереди), чтобы события UI обрабатывались в том же кадре и гарантированно запускали следующий repaint. Проверить, что проект/selection начинают обновляться с первого клика.
2. После десериализации `PlayaApp` заново создать `event_bus`+`comp_event_sender` связку и вызвать `attach_comp_event_sender()` для всех comps; убедиться, что `ensure_default_comp()` тоже получает рабочий sender. Это восстановит сигналы `CurrentFrameChanged/LayersChanged/AttrsChanged`.
3. Добавить минимальное логирование очереди (длина/первый тип) в режиме debug, чтобы быстро ловить повтор подобных регрессий, и прогнать ручной сценарий: старт без воспроизведения → клик по клипу/кнопкам → убедиться, что выделение и загрузка клипов срабатывают без второго клика.
