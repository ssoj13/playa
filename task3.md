1. Нет, нам нужно удалить Layer. Он логически нигде не нужен, просто засоряет код ненужностями.
2. Кроме того я только что переосмыслил концепцию:
  - Comp будет и контейнером и слоем, который может содержать другие Comp.
  - Загрузка кадров с диска станет особым режимом:
    - Добавляем в Comp флаг "mode": с двумя значениями: mode_layer и mode_file.
    - Каждая Comp должна содержать следующие атрибуты:
      - position, rotate, scale, pivot, (эти Vec3 значения формируют внутреннюю transformation matrix4), transparency, layer_mode (normal, screen, add, substract, mult, divide), speed. границы комп должны корректно рассчитываться с учетом speed и всех смещений и тримов.
      - атрибут mode: enum со значениями mode_layer и mode_file
      - для режима file: file_mask, file_start, file_end. По умолчанию пустые (и если пустые или start==end то загрузка не идёт, выдаётся Placeholder)
      - атрибут parent: uuid, атрибут children: Vec<uuid> - это система parent-child relationship. Children - это под-слои этой Comp, другие Comp.
      - атрибут Comp::hash: содержит хэш композиции. В режиме layer это аккумулированные хэши всех подслоёв, в режиме file это хэш file_mask и file_start/end
      - добавляем атрибуты play_start, play_end. Для текущего компа они определяют его рабочую зону, для всех вложенных - буквально начало и конец. Т.е. вложенные Comps в Comp рисуются используя их внутренний play_start/end
    - Когда мы переключаем mode на mode_seq, то композ вместо сборки кадров и их композа, начинает читать файлы с диска. Если файлы не удаётся прочитать - выдаётся placeholder. Переносим функциональность загрузки и детекции image sequence в Comp.
    - то что выдаёт compose() кэшируется в Comp::cache[frame]. Кэш обновляется если у этого текущий хэш не совпадает с сохранённым в атрибутах - тогда обновляем хэш, считаем кадр compose(), записываем hash и Frame в атрибуты и данные.
    - Добавляем в Comp children: Vec<uuid> - это будут uuid children Comps
    - При передвижении (drag) клипов по таймлайну учитываем play_start и play_end. Клипы могут уехжать за левую границу timeline, там где их названия - просто названия рисуются поверх.

нужен какой-то универсальный алгоритм для рассчёта кадра для вложенных и ретаймленных comps. Это должна делать одна функция и для всего сразу.
Также нужен мэппинг на окно timeline: time ruler и time slider, а также все вложенные Comps должны "жить" в одном пространстве, в одном времени. В которое пользователь может зумиться и панорамировать в окне. Всё как с Viewport, но только в горизонтальном направлении онли и мы зумим кадры.
По сути нужна функция мэппинга из timeline_widget space в frame space - в внутреннее время Comp. Тут подскажи как лучше.
Всё должно быть унифицировано.


Кроме того нужно всё разделить на компоненты. Связывать всё будет PlayaApp и его UI.
Буквально: окно encoding и код encoding - в подкаталог, чтобы он был подмодулем и связывался с внешним миром сообщениями. Ну может какой-то быстрый интерфейс, т.к. нам нужно передавать кадры или рефы на них на кодирование.
Окно Preferences - в подкаталог.
Окно Project - в подкаталог
Окно Timeline, Viewport - тоже в подкаталог.


посмотри всё ли верно опмсано, проверь проект.
Есть ли ошибки, логические или фактические? Слабые места?
Учти что мне нужно чтобы этот плеер работал с гигантскими файлами, избегай копирования памяти.

Составь краткий но подробный анализ и пошаговый оптимальный план действий

Используй MCP, sub-agents и работай параллельно.